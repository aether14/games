<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Memory Flash</title>
  <style>
    :root{
      --bg:#0b0f17; --panel:#111a2b; --panel2:#0f1626;
      --text:#e7ecff; --muted:#9aa6c3;
      --accent:#7c5cff; --good:#35d07f; --bad:#ff4d6d; --warn:#ffd166;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Yu Gothic", sans-serif;
      background: radial-gradient(1200px 700px at 20% 0%, #1b2a5a 0%, var(--bg) 55%),
                  radial-gradient(900px 600px at 100% 30%, #3a1b5a 0%, transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .app{
      width:min(980px, 100%);
      display:grid;
      grid-template-columns: 340px 1fr;
      gap:16px;
    }
    @media (max-width: 860px){
      .app{grid-template-columns:1fr}
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .pad{padding:18px}
    h1{font-size:18px; margin:0 0 6px}
    .sub{color:var(--muted); font-size:13px; line-height:1.5}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    button{
      appearance:none; border:none; cursor:pointer;
      background: rgba(124,92,255,.18);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-weight:700;
      border:1px solid rgba(124,92,255,.35);
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{transform: translateY(-1px); background: rgba(124,92,255,.26)}
    button:active{transform: translateY(0px) scale(.99)}
    button:disabled{
      opacity:.45; cursor:not-allowed; transform:none;
    }
    .ghost{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
    }
    .danger{
      background: rgba(255,77,109,.14);
      border-color: rgba(255,77,109,.28);
    }
    .stats{
      display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:14px;
    }
    .stat{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      padding:10px 12px;
    }
    .stat .k{color:var(--muted); font-size:12px}
    .stat .v{font-size:18px; font-weight:800; margin-top:2px}
    .msg{
      margin-top:12px;
      padding:10px 12px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;
      line-height:1.5;
      font-size:13px;
    }
    .msg.good{border-color: rgba(53,208,127,.35)}
    .msg.bad{border-color: rgba(255,77,109,.35)}
    .msg.warn{border-color: rgba(255,209,102,.35)}
    .board{
      padding:18px;
      background: linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.10));
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:12px;
    }
    @media (max-width: 520px){
      .grid{grid-template-columns: repeat(3, minmax(0, 1fr))}
    }
    .tile{
      user-select:none;
      height:92px;
      border-radius:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:34px;
      font-weight:900;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 18px rgba(0,0,0,.18);
      transition: transform .08s ease, background .18s ease, border-color .18s ease;
    }
    .tile:active{transform: scale(.99)}
    .tile.disabled{opacity:.55; pointer-events:none}
    .tile.flash{
      background: rgba(124,92,255,.26);
      border-color: rgba(124,92,255,.50);
      transform: translateY(-2px);
    }
    .tile.pick{
      background: rgba(53,208,127,.18);
      border-color: rgba(53,208,127,.40);
    }
    .tile.wrong{
      background: rgba(255,77,109,.18);
      border-color: rgba(255,77,109,.40);
    }
    .footerHint{
      margin-top:10px;
      color: var(--muted);
      font-size:12px;
      text-align:right;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      font-size:12px;
      color:var(--muted);
      margin-top:10px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
      padding:2px 6px;
      border-radius:8px;
      color: var(--text);
      font-weight:700;
      font-size:12px;
    }
  </style>
</head>
<body>
  <div class="app">
    <section class="card pad">
      <h1>Memory Flash</h1>
      <div class="sub">
        3ç§’ã ã‘è¡¨ç¤ºã•ã‚Œã‚‹é †ç•ªã‚’è¦šãˆã¦ã€åŒã˜é †ã§æŠ¼ã™ã‚²ãƒ¼ãƒ ã€‚<br>
        å¤±æ•—ã™ã‚‹ã¨ãƒ¬ãƒ™ãƒ«1ã‹ã‚‰ã€‚å›ã®è„³å†…RAMã‚’æ¸¬ã‚‹ã‚„ã¤ã€‚
      </div>

      <div class="stats">
        <div class="stat"><div class="k">ãƒ¬ãƒ™ãƒ«</div><div class="v" id="level">1</div></div>
        <div class="stat"><div class="k">æœ€é«˜ãƒ¬ãƒ™ãƒ«</div><div class="v" id="best">1</div></div>
        <div class="stat"><div class="k">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div><div class="v" id="status">å¾…æ©Ÿ</div></div>
        <div class="stat"><div class="k">å…¥åŠ›</div><div class="v" id="progress">0/0</div></div>
      </div>

      <div class="row">
        <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button id="nextBtn" class="ghost" disabled>æ¬¡ã®ãƒ¬ãƒ™ãƒ«</button>
        <button id="retryBtn" class="danger">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <div id="message" class="msg warn">ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã™ã¨ã€é †ç•ªãŒå…‰ã‚Šã¾ã™ã€‚è¦‹çµ‚ã‚ã£ãŸã‚‰åŒã˜é †ã§æŠ¼ã—ã¦ã­ã€‚</div>

      <div class="pill">
        æ“ä½œ: ã‚¯ãƒªãƒƒã‚¯ / ã‚¿ãƒƒãƒ—ã€€
        <span class="kbd">R</span>ã§ãƒªã‚»ãƒƒãƒˆ
      </div>
    </section>

    <section class="card board">
      <div class="grid" id="grid"></div>
      <div class="footerHint">â€»éŸ³ã¯ã¾ã ç„¡ã„ã€‚æ¬¡ã®å¼·åŒ–ã§å…¥ã‚Œã‚ˆã†ã€‚</div>
    </section>
  </div>

  <script>
    // ====== è¨­å®š ======
    const EMOJIS = ["ğŸ“","ğŸ‹","ğŸ‡","ğŸ‰","ğŸ’","ğŸ¥","ğŸ‘","ğŸ","ğŸ","ğŸŒ","ğŸ¥¥","ğŸ«"];
    const GRID_SIZE = 12;          // 12ã‚¿ã‚¤ãƒ«
    const FLASH_MS = 420;          // 1å›å…‰ã‚‹æ™‚é–“
    const GAP_MS = 140;            // å…‰ã‚Šã®é–“éš”
    const SHOW_COUNT_BASE = 3;     // ãƒ¬ãƒ™ãƒ«1ã®è¡¨ç¤ºæ•°ï¼ˆ3ã¤ï¼‰
    const SHOW_COUNT_CAP = 9;      // æœ€å¤§è¡¨ç¤ºæ•°
    const PREVIEW_WAIT_MS = 450;   // ã‚¹ã‚¿ãƒ¼ãƒˆå¾Œã€ç‚¹æ»…é–‹å§‹ã¾ã§å°‘ã—å¾…ã¤

    // ====== çŠ¶æ…‹ ======
    const state = {
      level: 1,
      best: 1,
      phase: "idle", // idle | preview | input | clear | fail
      sequence: [],
      inputIndex: 0,
      locked: false
    };

    // ====== DOM ======
    const gridEl = document.getElementById("grid");
    const levelEl = document.getElementById("level");
    const bestEl  = document.getElementById("best");
    const statusEl= document.getElementById("status");
    const progressEl = document.getElementById("progress");
    const msgEl = document.getElementById("message");
    const startBtn = document.getElementById("startBtn");
    const nextBtn  = document.getElementById("nextBtn");
    const retryBtn = document.getElementById("retryBtn");

    const tiles = [];

    function setMessage(text, kind="warn"){
      msgEl.className = "msg " + kind;
      msgEl.textContent = text;
    }

    function setPhase(phase){
      state.phase = phase;
      statusEl.textContent =
        phase === "idle" ? "å¾…æ©Ÿ" :
        phase === "preview" ? "è¡¨ç¤ºä¸­" :
        phase === "input" ? "å…¥åŠ›ä¸­" :
        phase === "clear" ? "ã‚¯ãƒªã‚¢" :
        phase === "fail" ? "å¤±æ•—" : phase;
      const canClick = (phase === "input");
      tiles.forEach(t => {
        t.el.classList.toggle("disabled", !canClick);
      });
      startBtn.disabled = !(phase === "idle");
      nextBtn.disabled = !(phase === "clear");
    }

    function updateUI(){
      levelEl.textContent = state.level;
      bestEl.textContent  = state.best;
      progressEl.textContent = `${state.inputIndex}/${state.sequence.length}`;
    }

    function pickCountForLevel(level){
      const n = Math.min(SHOW_COUNT_BASE + (level - 1), SHOW_COUNT_CAP);
      return n;
    }

    function makeSequence(count){
      const seq = [];
      for (let i=0; i<count; i++){
        const idx = Math.floor(Math.random() * GRID_SIZE);
        seq.push(idx);
      }
      return seq;
    }

    function clearTileClasses(){
      tiles.forEach(t=>{
        t.el.classList.remove("flash","pick","wrong");
      });
    }

    function flashTile(i){
      const t = tiles[i];
      t.el.classList.add("flash");
      setTimeout(()=> t.el.classList.remove("flash"), FLASH_MS);
    }

    async function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

    async function previewSequence(){
      setPhase("preview");
      clearTileClasses();
      state.inputIndex = 0;
      updateUI();

      await sleep(PREVIEW_WAIT_MS);

      for (let i=0; i<state.sequence.length; i++){
        flashTile(state.sequence[i]);
        await sleep(FLASH_MS + GAP_MS);
      }

      setPhase("input");
      setMessage("OKï¼åŒã˜é †ã§æŠ¼ã—ã¦ã­ã€‚", "warn");
      updateUI();
    }

    function startLevel(){
      const count = pickCountForLevel(state.level);
      state.sequence = makeSequence(count);
      state.inputIndex = 0;
      setMessage(`ãƒ¬ãƒ™ãƒ«${state.level}ï¼š${count}å€‹ã®é †ç•ªã‚’è¦šãˆã¦ã­ã€‚`, "warn");
      updateUI();
      previewSequence();
    }

    function handlePick(tileIndex){
      if (state.phase !== "input") return;

      const expected = state.sequence[state.inputIndex];

      if (tileIndex === expected){
        tiles[tileIndex].el.classList.add("pick");
        setTimeout(()=> tiles[tileIndex].el.classList.remove("pick"), 160);

        state.inputIndex++;
        updateUI();

        if (state.inputIndex >= state.sequence.length){
          // Clear
          setPhase("clear");
          state.best = Math.max(state.best, state.level);
          bestEl.textContent = state.best;
          setMessage(`ã‚¯ãƒªã‚¢ï¼æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¸è¡Œã‘ã‚‹ã€‚è„³ãŒå…‰ã£ã¦ã‚‹ã€‚`, "good");
        }
      } else {
        tiles[tileIndex].el.classList.add("wrong");
        setTimeout(()=> tiles[tileIndex].el.classList.remove("wrong"), 220);

        setPhase("fail");
        setMessage(`æ®‹å¿µï¼æ­£è§£ã¯ã€Œ${state.inputIndex+1}ç•ªç›®ã€ãŒé•ã£ãŸã€‚ãƒ¬ãƒ™ãƒ«1ã«æˆ»ã‚‹ã‚ˆã€‚`, "bad");
        // å°‘ã—è¦‹ã›ã¦ã‹ã‚‰ãƒªã‚»ãƒƒãƒˆå¯èƒ½çŠ¶æ…‹ã¸
        setTimeout(()=>{
          state.level = 1;
          setPhase("idle");
          setMessage("ãƒªã‚»ãƒƒãƒˆå®Œäº†ã€‚ã‚¹ã‚¿ãƒ¼ãƒˆã§å†æŒ‘æˆ¦ï¼", "warn");
          updateUI();
        }, 800);
      }
    }

    function resetAll(){
      state.level = 1;
      state.best = 1;
      state.sequence = [];
      state.inputIndex = 0;
      clearTileClasses();
      setPhase("idle");
      setMessage("ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã™ã¨ã€é †ç•ªãŒå…‰ã‚Šã¾ã™ã€‚è¦‹çµ‚ã‚ã£ãŸã‚‰åŒã˜é †ã§æŠ¼ã—ã¦ã­ã€‚", "warn");
      updateUI();
    }

    function nextLevel(){
      state.level++;
      setPhase("idle");
      setMessage("æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã«é€²ã‚€æº–å‚™OKã€‚ã‚¹ã‚¿ãƒ¼ãƒˆæŠ¼ã—ã¦ã­ã€‚", "warn");
      updateUI();
    }

    function initGrid(){
      gridEl.innerHTML = "";
      tiles.length = 0;

      for (let i=0; i<GRID_SIZE; i++){
        const el = document.createElement("div");
        el.className = "tile";
        el.textContent = EMOJIS[i % EMOJIS.length];
        el.addEventListener("click", ()=> handlePick(i));
        gridEl.appendChild(el);
        tiles.push({el, idx:i});
      }

      setPhase("idle");
      updateUI();
    }

    // buttons
    startBtn.addEventListener("click", ()=> startLevel());
    nextBtn.addEventListener("click", ()=> { nextLevel(); startLevel(); });
    retryBtn.addEventListener("click", ()=> resetAll());

    // keyboard
    window.addEventListener("keydown", (e)=>{
      if (e.key.toLowerCase() === "r") resetAll();
    });

    initGrid();
    setMessage("ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã™ã¨ã€é †ç•ªãŒå…‰ã‚Šã¾ã™ã€‚è¦‹çµ‚ã‚ã£ãŸã‚‰åŒã˜é †ã§æŠ¼ã—ã¦ã­ã€‚", "warn");
  </script>
</body>
</html>
